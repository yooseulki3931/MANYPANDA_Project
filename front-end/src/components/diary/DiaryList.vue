<template>
  <!-- DiaryList.vue -->

  <div id="diary_back">
    <!-- ì „ì²´ ëª©ë¡ ì¡°íšŒ ì‹œì‘ -->
    <div>
      <div>
        <h4 id="diary_logo">ğŸ’Œ DIARY ğŸ’Œ</h4>
      </div>

      <div class="diaryList">
        <ul class="list-group">
          <li
            id="diary_title"
            class="list-group-item"
            :class="{ active: index == currentIndex }"
            v-for="(data, index) in diary"
            :key="index"
            @click="setActiveDiary(data, index)"
          >
            {{ data.dtitle }}
          </li>
        </ul>
      </div>
    </div>
    <!-- ì „ì²´ ëª©ë¡ ì¡°íšŒ ë -->
    <div></div>
    <!-- ê°„ëµ ìƒì„¸ ëª©ë¡ ì‹œì‘ -->
    <div class="editDiary">
      <div v-if="currentDiary" id="diary_content">
        <div>
          <label>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-chat-square-quote"
              viewBox="0 0 16 16"
            >
              <path
                d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2.5a2 2 0 0 0-1.6.8L8 14.333 6.1 11.8a2 2 0 0 0-1.6-.8H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"
              />
              <path
                d="M7.066 4.76A1.665 1.665 0 0 0 4 5.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 1 0 .6.58c1.486-1.54 1.293-3.214.682-4.112zm4 0A1.665 1.665 0 0 0 8 5.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 1 0 .6.58c1.486-1.54 1.293-3.214.682-4.112z"
              />
            </svg>
            <h4 id="diary_pen">{{ currentDiary.dtitle }}</h4></label
          >
        </div>
        <div id="diary_textarea">
          <label><strong></strong></label>
          {{ currentDiary.dcontent }}
        </div>
        <div>
          <label><strong></strong></label>
          {{ currentDiary.insertTime }}
        </div>

        <button
          id="diary_modal_edit"
          type="button"
          class="btn btn-outline-secondary"
          data-bs-toggle="modal"
          data-bs-target="#exampleModala"
          style="
            width: 100px;
            font-size: 12px;
            height: 50px;
            text-align: center;
            background-color: lavender;
          "
        >
          ìˆ˜ì •
        </button>

        <div
          class="modal fade"
          id="exampleModala"
          tabindex="-1"
          aria-labelledby="exampleModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">EDIT</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <!-- DiaryDetail.vue -->
                <div>
                  <!-- ìˆ˜ì • ì–‘ì‹ í¼ ì‹œì‘ -->
                  <div v-if="currentDiary" class="edit-form" id="diary_add">
                    <div>
                      <form>
                        <div class="form-group">
                          <label for="dtitle">ì œëª©</label>
                          <input
                            type="text"
                            class="form-control"
                            id="dtitle"
                            v-model="currentDiary.dtitle"
                          />
                        </div>
                        <div class="mt-3 form-group">
                          <label for="dcontent">ë‚´ìš©</label>
                          <textarea
                            type="text"
                            class="form-control"
                            id="dcontent"
                            v-model="currentDiary.dcontent"
                            style="
                              display: inline;
                              height: 300px;
                              white-space: normal;
                              text-align: start;
                            "
                          />
                        </div>
                      </form>

                      <div>
                        <button
                          class="btn"
                          @click="updateDiary"
                          id="diary_Detail_badge"
                          style="
                            width: 100px;
                            font-size: 12px;
                            height: 50px;
                            text-align: center;
                            background-color: gray;
                          "
                        >
                          ìˆ˜ì •
                        </button>
                        <button
                          class="btn"
                          type="submit"
                          @click="deleteDiary"
                          id="diary_Detail_badge"
                          style="
                            width: 100px;
                            font-size: 12px;
                            height: 50px;
                            text-align: center;
                            background-color: gray;
                          "
                        >
                          ì‚­ì œ
                        </button>
                      </div>
                    </div>
                    <!-- ìˆ˜ì • ì–‘ì‹ í¼ ë -->
                  </div>
                  <div v-else>
                    <br />
                    <p>ë‹¤ì´ì–´ë¦¬ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
                  </div>
                </div>

                <!-- =========================== -->
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  data-bs-dismiss="modal"
                >
                  ë‹«ê¸°
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-else>
        <br />
        <p>ì œëª©ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
      </div>

      <button
        type="button"
        class="btn"
        data-bs-toggle="modal"
        data-bs-target="#exampleModal"
        style="
          width: 100px;
          font-size: 12px;
          height: 50px;
          text-align: center;
          background-color: lavenderblush;
        "
      >
        ê¸€ì“°ê¸°
      </button>

      <!-- ê¸€ì“°ê¸°ëª¨ë‹¬ -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">WRITE</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <AddDiary></AddDiary>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                ë‹«ê¸°
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ê°„ëµ ìƒì„¸ ëª©ë¡ ë -->
  </div>
</template>

<script>
// axios ê³µí†µí•¨ìˆ˜ import
import DiaryDataService from "../../services/DiaryDataService";
import AddDiary from "./AddDiary.vue";

export default {
  // ë³€ìˆ˜ ì •ì˜í•˜ëŠ” ê³³ : data(), ì´ˆê¸°í™”
  props: ["idProps"],
  data() {
    return {
      diary: [],
      currentDiary: null,
      currentIndex: -1,
      dtitle: "",
      id: this.idProps,
    };
  },
  components: {
    AddDiary,
  },
  // í•¨ìˆ˜ ì •ì˜í•˜ëŠ” ê³³ : methods:
  methods: {
    // axios , ëª¨ë“  ë‹¤ì´ì–´ë¦¬ ì •ë³´ ì¡°íšŒ ìš”ì²­ í•¨ìˆ˜
    retrieveDiary() {
      DiaryDataService.getAll(this.id)
        // ì„±ê³µí•˜ë©´ .then() ê²°ê³¼ê°€ ì „ì†¡ë¨
        .then((response) => {
          this.diary = response.data; // springboot ì˜ ì „ì†¡ëœ ë‹¤ì´ì–´ë¦¬ ì •ë³´
          // ë””ë²„ê¹… ì½˜ì†”ì— ì •ë³´ ì¶œë ¥
          console.log(response.data);
        })
        // ì‹¤íŒ¨í•˜ë©´ .catch() ì— ì—ëŸ¬ê°€ ì „ì†¡ë¨
        .catch((e) => {
          console.log(e);
        });
    },
    // ëª©ë¡ì„ í´ë¦­í–ˆì„ë•Œ í˜„ì¬ ë‹¤ì´ì–´ë¦¬ ê°ì²´, ì¸ë±ìŠ¤ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    setActiveDiary(data, index) {
      this.currentDiary = data;
      this.currentIndex = index;
    },
    // ===================

    // ë‹¤ì´ì–´ë¦¬ ë²ˆí˜¸(dno)ë¡œ ì¡°íšŒ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
    getDiary() {
      // axios ê³µí†µí•¨ìˆ˜ í˜¸ì¶œ
      DiaryDataService.get(this.id)
        // ì„±ê³µí•˜ë©´ .then() ê²°ê³¼ê°€ ë¦¬í„´ë¨
        .then((response) => {
          // springboot ê²°ê³¼ë¥¼ ë¦¬í„´í•¨
          this.currentDiary = response.data;
          // ì½˜ì†” ë¡œê·¸ ì¶œë ¥
          console.log(response.data);
        })
        // ì‹¤íŒ¨í•˜ë©´ .catch() ì—ëŸ¬ë©”ì„¸ì§€ê°€ ë¦¬í„´ë¨
        .catch((e) => {
          console.log(e);
        });
    },
    // ë‹¤ì´ì–´ë¦¬ ì •ë³´ë¥¼ ìˆ˜ì • ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
    updateDiary() {
      // axios ê³µí†µí•¨ìˆ˜ í˜¸ì¶œ
      DiaryDataService.update(this.currentDiary.dno, this.currentDiary)
        // ì„±ê³µí•˜ë©´ then() ê²°ê³¼ê°€ ì „ì†¡ë¨
        .then((response) => {
          console.log(response.data);
          // ì²«í˜ì´ì§€(ì „ì²´ëª©ë¡_ì¡°íšŒ_í˜ì´ì§€) ê°•ì œ ì´ë™ : /diary
          // this.$router.push("/myPage");
          // location.reload();
          this.retrieveDiary(); // í™”ë©´ ë¡œë”©ì‹œ ì „ì²´ ì¡°íšŒí•¨ìˆ˜ ì‹¤
        })
        // ì‹¤íŒ¨í•˜ë©´ .catch() ì—ëŸ¬ë©”ì„¸ì§€ê°€ ì „ì†¡ë¨
        .catch((e) => {
          console.log(e);
        });
    },
    // ë‹¤ì´ì–´ë¦¬ ì •ë³´ë¥¼ ì‚­ì œ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
    deleteDiary() {
      // axios ê³µí†µí•¨ìˆ˜ í˜¸ì¶œ
      DiaryDataService.delete(this.currentDiary.dno, this.currentDiary)
        // ì„±ê³µí•˜ë©´ then() ê²°ê³¼ê°€ ì „ì†¡ë¨
        .then((response) => {
          console.log(response.data);
          // ì²«í˜ì´ì§€(ì „ì²´ëª©ë¡_ì¡°íšŒ_í˜ì´ì§€) ê°•ì œ ì´ë™ : /diary
          // this.$router.push("/myPage");
          // location.reload();
          this.retrieveDiary(); // í™”ë©´ ë¡œë”©ì‹œ ì „ì²´ ì¡°íšŒí•¨ìˆ˜ ì‹¤
        })
        // ì‹¤íŒ¨í•˜ë©´ .catch() ì—ëŸ¬ë©”ì„¸ì§€ê°€ ì „ì†¡ë¨
        .catch((e) => {
          console.log(e);
        });
    },
  },

  // í™”ë©´ì´ ëœ¨ìë§ˆì ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸(ë¼ì´í”„ ì‚¬ì´í´ í•¨ìˆ˜) : mounted(), created()
  mounted() {
    this.retrieveDiary(); // í™”ë©´ ë¡œë”©ì‹œ ì „ì²´ ì¡°íšŒí•¨ìˆ˜ \

    this.message = "";
    //  this.$route.params.no : ì´ì „í˜ì´ì§€ì—ì„œ ì „ì†¡í•œ ë§¤ê°œë³€ìˆ˜ëŠ” $route.params ì•ˆì— ìˆìŒ
    // $route ê°ì²´ : ì£¼ë¡œ url ë§¤ê°œë³€ìˆ˜ ì •ë³´ë“¤ì´ ìˆìŒ
    // router/index.js ìƒì„¸í˜ì´ì§€ urlì˜ ë§¤ê°œë³€ìˆ˜ëª… : :no
    this.getDiary(this.$route.params.dno);
  },
};
</script>

<style>
@import url(@/assets/css/style.css);
.diaryList {
  width: 800px;
  margin: auto;
}
.editDiary {
  width: 900px;
  margin: auto;
}
</style>
