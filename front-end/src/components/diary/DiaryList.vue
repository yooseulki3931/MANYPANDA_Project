<template>
  <!-- DiaryList.vue -->

  <div id="diary_back">
    <!-- Ï†ÑÏ≤¥ Î™©Î°ù Ï°∞Ìöå ÏãúÏûë -->
    <div>
      <div>
        <h4 id="diary_logo">üíå DIARY üíå</h4>
      </div>

      <div class="diaryList">
        <ul class="list-group">
          <li
            id="diary_title"
            class="list-group-item"
            :class="{ active: index == currentIndex }"
            v-for="(data, index) in diary"
            :key="index"
            @click="setActiveDiary(data, index)"
          >
            {{ data.dtitle }}
          </li>
        </ul>
      </div>
    </div>
    <!-- Ï†ÑÏ≤¥ Î™©Î°ù Ï°∞Ìöå ÎÅù -->
    <div></div>
    <!-- Í∞ÑÎûµ ÏÉÅÏÑ∏ Î™©Î°ù ÏãúÏûë -->
    <div class="editDiary">
      <div v-if="currentDiary" id="diary_content">
        <div>
          <label>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-chat-square-quote"
              viewBox="0 0 16 16"
            >
              <path
                d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2.5a2 2 0 0 0-1.6.8L8 14.333 6.1 11.8a2 2 0 0 0-1.6-.8H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"
              />
              <path
                d="M7.066 4.76A1.665 1.665 0 0 0 4 5.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 1 0 .6.58c1.486-1.54 1.293-3.214.682-4.112zm4 0A1.665 1.665 0 0 0 8 5.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 1 0 .6.58c1.486-1.54 1.293-3.214.682-4.112z"
              />
            </svg>
            <h4 id="diary_pen">{{ currentDiary.dtitle }}</h4></label
          >
        </div>
        <div id="diary_textarea">
          <label><strong></strong></label>
          {{ currentDiary.dcontent }}
        </div>
        <div>
          <label><strong></strong></label>
          {{ currentDiary.insertTime }}
        </div>

        <button
          id="diary_modal_edit"
          type="button"
          class="btn btn-outline-secondary"
          data-bs-toggle="modal"
          data-bs-target="#exampleModala"
          style="
            width: 100px;
            font-size: 12px;
            height: 50px;
            text-align: center;
            background-color: lavender;
          "
        >
          ÏàòÏ†ï
        </button>

        <div
          class="modal fade"
          id="exampleModala"
          tabindex="-1"
          aria-labelledby="exampleModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">EDIT</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <!-- DiaryDetail.vue -->
                <div>
                  <!-- ÏàòÏ†ï ÏñëÏãù Ìèº ÏãúÏûë -->
                  <div v-if="currentDiary" class="edit-form" id="diary_add">
                    <div>
                      <form>
                        <div class="form-group">
                          <label for="dtitle">Ï†úÎ™©</label>
                          <input
                            type="text"
                            class="form-control"
                            id="dtitle"
                            v-model="currentDiary.dtitle"
                          />
                        </div>
                        <div class="mt-3 form-group">
                          <label for="dcontent">ÎÇ¥Ïö©</label>
                          <textarea
                            type="text"
                            class="form-control"
                            id="dcontent"
                            v-model="currentDiary.dcontent"
                            style="
                              display: inline;
                              height: 300px;
                              white-space: normal;
                              text-align: start;
                            "
                          />
                        </div>
                      </form>

                      <div>
                        <button
                          class="btn"
                          @click="updateDiary"
                          id="diary_Detail_badge"
                          style="
                            width: 100px;
                            font-size: 12px;
                            height: 50px;
                            text-align: center;
                            background-color: gray;
                          "
                        >
                          ÏàòÏ†ï
                        </button>
                        <button
                          class="btn"
                          type="submit"
                          @click="deleteDiary"
                          id="diary_Detail_badge"
                          style="
                            width: 100px;
                            font-size: 12px;
                            height: 50px;
                            text-align: center;
                            background-color: gray;
                          "
                        >
                          ÏÇ≠Ï†ú
                        </button>
                      </div>
                    </div>
                    <!-- ÏàòÏ†ï ÏñëÏãù Ìèº ÎÅù -->
                  </div>
                  <div v-else>
                    <br />
                    <p>Îã§Ïù¥Ïñ¥Î¶¨Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî!</p>
                  </div>
                </div>

                <!-- =========================== -->
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  data-bs-dismiss="modal"
                >
                  Îã´Í∏∞
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-else>
        <br />
        <p>Ï†úÎ™©ÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî!</p>
      </div>

      <button
        type="button"
        class="btn"
        data-bs-toggle="modal"
        data-bs-target="#exampleModal"
        style="
          width: 100px;
          font-size: 12px;
          height: 50px;
          text-align: center;
          background-color: lavenderblush;
        "
      >
        Í∏ÄÏì∞Í∏∞
      </button>

      <!-- Í∏ÄÏì∞Í∏∞Î™®Îã¨ -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">WRITE</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <AddDiary></AddDiary>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                Îã´Í∏∞
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Í∞ÑÎûµ ÏÉÅÏÑ∏ Î™©Î°ù ÎÅù -->
  </div>
</template>

<script>
// axios Í≥µÌÜµÌï®Ïàò import
import DiaryDataService from "../../services/DiaryDataService";
import AddDiary from "./AddDiary.vue";

export default {
  // Î≥ÄÏàò Ï†ïÏùòÌïòÎäî Í≥≥ : data(), Ï¥àÍ∏∞Ìôî
  props: ["idProps"],
  data() {
    return {
      diary: [],
      currentDiary: null,
      currentIndex: -1,
      dtitle: "",
      id: this.idProps,
    };
  },
  components: {
    AddDiary,
  },
  // Ìï®Ïàò Ï†ïÏùòÌïòÎäî Í≥≥ : methods:
  methods: {
    // axios , Î™®Îì† Îã§Ïù¥Ïñ¥Î¶¨ Ï†ïÎ≥¥ Ï°∞Ìöå ÏöîÏ≤≠ Ìï®Ïàò
    retrieveDiary() {
      DiaryDataService.getAll(this.id)
        // ÏÑ±Í≥µÌïòÎ©¥ .then() Í≤∞Í≥ºÍ∞Ä Ï†ÑÏÜ°Îê®
        .then((response) => {
          this.diary = response.data; // springboot Ïùò Ï†ÑÏÜ°Îêú Îã§Ïù¥Ïñ¥Î¶¨ Ï†ïÎ≥¥
          // ÎîîÎ≤ÑÍπÖ ÏΩòÏÜîÏóê Ï†ïÎ≥¥ Ï∂úÎ†•
          console.log(response.data);
        })
        // Ïã§Ìå®ÌïòÎ©¥ .catch() Ïóê ÏóêÎü¨Í∞Ä Ï†ÑÏÜ°Îê®
        .catch((e) => {
          console.log(e);
        });
    },
    // Î™©Î°ùÏùÑ ÌÅ¥Î¶≠ÌñàÏùÑÎïå ÌòÑÏû¨ Îã§Ïù¥Ïñ¥Î¶¨ Í∞ùÏ≤¥, Ïù∏Îç±Ïä§Î≤àÌò∏Î•º Ï†ÄÏû•ÌïòÎäî Ìï®Ïàò
    setActiveDiary(data, index) {
      this.currentDiary = data;
      this.currentIndex = index;
    },
    // ===================

    // Îã§Ïù¥Ïñ¥Î¶¨ Î≤àÌò∏(dno)Î°ú Ï°∞Ìöå ÏöîÏ≤≠ÌïòÎäî Ìï®Ïàò
    getDiary() {
      // axios Í≥µÌÜµÌï®Ïàò Ìò∏Ï∂ú
      DiaryDataService.get(this.id)
        // ÏÑ±Í≥µÌïòÎ©¥ .then() Í≤∞Í≥ºÍ∞Ä Î¶¨ÌÑ¥Îê®
        .then((response) => {
          // springboot Í≤∞Í≥ºÎ•º Î¶¨ÌÑ¥Ìï®
          this.currentDiary = response.data;
          // ÏΩòÏÜî Î°úÍ∑∏ Ï∂úÎ†•
          console.log(response.data);
        })
        // Ïã§Ìå®ÌïòÎ©¥ .catch() ÏóêÎü¨Î©îÏÑ∏ÏßÄÍ∞Ä Î¶¨ÌÑ¥Îê®
        .catch((e) => {
          console.log(e);
        });
    },
    // Îã§Ïù¥Ïñ¥Î¶¨ Ï†ïÎ≥¥Î•º ÏàòÏ†ï ÏöîÏ≤≠ÌïòÎäî Ìï®Ïàò
    updateDiary() {
      // axios Í≥µÌÜµÌï®Ïàò Ìò∏Ï∂ú
      DiaryDataService.update(this.currentDiary.dno, this.currentDiary)
        // ÏÑ±Í≥µÌïòÎ©¥ then() Í≤∞Í≥ºÍ∞Ä Ï†ÑÏÜ°Îê®
        .then((response) => {
          console.log(response.data);
          // Ï≤´ÌéòÏù¥ÏßÄ(Ï†ÑÏ≤¥Î™©Î°ù_Ï°∞Ìöå_ÌéòÏù¥ÏßÄ) Í∞ïÏ†ú Ïù¥Îèô : /diary
          // this.$router.push("/myPage");
          // location.reload();
          this.retrieveDiary(); // ÌôîÎ©¥ Î°úÎî©Ïãú Ï†ÑÏ≤¥ Ï°∞ÌöåÌï®Ïàò Ïã§
        })
        // Ïã§Ìå®ÌïòÎ©¥ .catch() ÏóêÎü¨Î©îÏÑ∏ÏßÄÍ∞Ä Ï†ÑÏÜ°Îê®
        .catch((e) => {
          console.log(e);
        });
    },
    // Îã§Ïù¥Ïñ¥Î¶¨ Ï†ïÎ≥¥Î•º ÏÇ≠Ï†ú ÏöîÏ≤≠ÌïòÎäî Ìï®Ïàò
    deleteDiary() {
      // axios Í≥µÌÜµÌï®Ïàò Ìò∏Ï∂ú
      DiaryDataService.delete(this.currentDiary.dno, this.currentDiary)
        // ÏÑ±Í≥µÌïòÎ©¥ then() Í≤∞Í≥ºÍ∞Ä Ï†ÑÏÜ°Îê®
        .then((response) => {
          console.log(response.data);
          // Ï≤´ÌéòÏù¥ÏßÄ(Ï†ÑÏ≤¥Î™©Î°ù_Ï°∞Ìöå_ÌéòÏù¥ÏßÄ) Í∞ïÏ†ú Ïù¥Îèô : /diary
          // this.$router.push("/myPage");
          // location.reload();
          this.retrieveDiary(); // ÌôîÎ©¥ Î°úÎî©Ïãú Ï†ÑÏ≤¥ Ï°∞ÌöåÌï®Ïàò Ïã§
        })
        // Ïã§Ìå®ÌïòÎ©¥ .catch() ÏóêÎü¨Î©îÏÑ∏ÏßÄÍ∞Ä Ï†ÑÏÜ°Îê®
        .catch((e) => {
          console.log(e);
        });
    },
  },

  // ÌôîÎ©¥Ïù¥ Îú®ÏûêÎßàÏûê Ïã§ÌñâÎêòÎäî Ïù¥Î≤§Ìä∏(ÎùºÏù¥ÌîÑ ÏÇ¨Ïù¥ÌÅ¥ Ìï®Ïàò) : mounted(), created()
  mounted() {
    this.retrieveDiary(); // ÌôîÎ©¥ Î°úÎî©Ïãú Ï†ÑÏ≤¥ Ï°∞ÌöåÌï®Ïàò \

    this.message = "";
    //  this.$route.params.no : Ïù¥Ï†ÑÌéòÏù¥ÏßÄÏóêÏÑú Ï†ÑÏÜ°Ìïú Îß§Í∞úÎ≥ÄÏàòÎäî $route.params ÏïàÏóê ÏûàÏùå
    // $route Í∞ùÏ≤¥ : Ï£ºÎ°ú url Îß§Í∞úÎ≥ÄÏàò Ï†ïÎ≥¥Îì§Ïù¥ ÏûàÏùå
    // router/index.js ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ urlÏùò Îß§Í∞úÎ≥ÄÏàòÎ™Ö : :no
    this.getDiary(this.$route.params.dno);
  },
};
</script>

<style>
@import url(@/assets/css/style.css);
.diaryList {
  width: 800px;
  margin: auto;
}
.editDiary {
  width: 900px;
  margin: auto;
}
</style>
